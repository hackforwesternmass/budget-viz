(function () {
// Generated by CoffeeScript 1.4.0
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h=[].slice,p=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},d={}.hasOwnProperty,v=function(e,t){function r(){this.constructor=e}for(var n in t)d.call(t,n)&&(e[n]=t[n]);r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},m=function(e,t){return function(){return e.apply(t,arguments)}};n={bind:function(e,t){var n,r,i,s,o;r=e.split(" ");n=this.hasOwnProperty("_callbacks")&&this._callbacks||(this._callbacks={});for(s=0,o=r.length;s<o;s++){i=r[s];n[i]||(n[i]=[]);n[i].push(t)}return this},one:function(e,t){return this.bind(e,function(){this.unbind(e,arguments.callee);return t.apply(this,arguments)})},trigger:function(){var e,t,n,r,i,s,o;e=1<=arguments.length?h.call(arguments,0):[];n=e.shift();r=this.hasOwnProperty("_callbacks")&&((o=this._callbacks)!=null?o[n]:void 0);if(!r)return;for(i=0,s=r.length;i<s;i++){t=r[i];if(t.apply(this,e)===!1)break}return!0},unbind:function(e,t){var n,r,i,s,o,u,a,f,l,c;if(!e){this._callbacks={};return this}r=e.split(" ");for(u=0,f=r.length;u<f;u++){o=r[u];s=(c=this._callbacks)!=null?c[o]:void 0;if(!s)continue;if(!t){delete this._callbacks[o];continue}for(i=a=0,l=s.length;a<l;i=++a){n=s[i];if(n!==t)continue;s=s.slice();s.splice(i,1);this._callbacks[o]=s;break}}return this}};n.on=n.bind;n.off=n.unbind;r={trace:!0,logPrefix:"(App)",log:function(){var e;e=1<=arguments.length?h.call(arguments,0):[];if(!this.trace)return;this.logPrefix&&e.unshift(this.logPrefix);typeof console!="undefined"&&console!==null&&typeof console.log=="function"&&console.log.apply(console,e);return this}};c=["included","extended"];s=function(){function e(){typeof this.init=="function"&&this.init.apply(this,arguments)}e.include=function(e){var t,n,r;if(!e)throw new Error("include(obj) requires obj");for(t in e){n=e[t];p.call(c,t)<0&&(this.prototype[t]=n)}(r=e.included)!=null&&r.apply(this);return this};e.extend=function(e){var t,n,r;if(!e)throw new Error("extend(obj) requires obj");for(t in e){n=e[t];p.call(c,t)<0&&(this[t]=n)}(r=e.extended)!=null&&r.apply(this);return this};e.proxy=function(e){var t=this;return function(){return e.apply(t,arguments)}};e.prototype.proxy=function(e){var t=this;return function(){return e.apply(t,arguments)}};return e}();i=function(t){function r(e){r.__super__.constructor.apply(this,arguments);e&&this.load(e);this.cid=this.constructor.uid("c-")}v(r,t);r.extend(n);r.records={};r.crecords={};r.attributes=[];r.configure=function(){var e,t;t=arguments[0],e=2<=arguments.length?h.call(arguments,1):[];this.className=t;this.records={};this.crecords={};e.length&&(this.attributes=e);this.attributes&&(this.attributes=l(this.attributes));this.attributes||(this.attributes=[]);this.unbind();return this};r.toString=function(){return""+this.className+"("+this.attributes.join(", ")+")"};r.find=function(e){var t;t=this.records[e];if(!t&&(""+e).match(/c-\d+/))return this.findCID(e);if(!t)throw new Error('"'+this.className+'" model could not find a record for the ID "'+e+'"');return t.clone()};r.findCID=function(e){var t;t=this.crecords[e];if(!t)throw new Error('"'+this.className+'" model could not find a record for the ID "'+id+'"');return t.clone()};r.exists=function(e){try{return this.find(e)}catch(t){return!1}};r.refresh=function(e,t){var n,r,i,s;t==null&&(t={});if(t.clear){this.records={};this.crecords={}}r=this.fromJSON(e);a(r)||(r=[r]);for(i=0,s=r.length;i<s;i++){n=r[i];n.id||(n.id=n.cid);this.records[n.id]=n;this.crecords[n.cid]=n}this.trigger("refresh",this.cloneArray(r));return this};r.select=function(e){var t,n,r;r=function(){var r,i;r=this.records;i=[];for(t in r){n=r[t];e(n)&&i.push(n)}return i}.call(this);return this.cloneArray(r)};r.findByAttribute=function(e,t){var n,r,i;i=this.records;for(n in i){r=i[n];if(r[e]===t)return r.clone()}return null};r.findAllByAttribute=function(e,t){return this.select(function(n){return n[e]===t})};r.each=function(e){var t,n,r,i;r=this.records;i=[];for(t in r){n=r[t];i.push(e(n.clone()))}return i};r.all=function(){return this.cloneArray(this.recordsValues())};r.first=function(){var e;e=this.recordsValues()[0];return e!=null?e.clone():void 0};r.last=function(){var e,t;t=this.recordsValues();e=t[t.length-1];return e!=null?e.clone():void 0};r.count=function(){return this.recordsValues().length};r.deleteAll=function(){var e,t,n,r;n=this.records;r=[];for(e in n){t=n[e];r.push(delete this.records[e])}return r};r.destroyAll=function(e){var t,n,r,i;r=this.records;i=[];for(t in r){n=r[t];i.push(this.records[t].destroy(e))}return i};r.update=function(e,t,n){return this.find(e).updateAttributes(t,n)};r.create=function(e,t){var n;n=new this(e);return n.save(t)};r.destroy=function(e,t){return this.find(e).destroy(t)};r.change=function(e){return typeof e=="function"?this.bind("change",e):this.trigger("change",e)};r.fetch=function(e){return typeof e=="function"?this.bind("fetch",e):this.trigger("fetch",e)};r.toJSON=function(){return this.recordsValues()};r.fromJSON=function(e){var t,n,r,i;if(!e)return;typeof e=="string"&&(e=JSON.parse(e));if(a(e)){i=[];for(n=0,r=e.length;n<r;n++){t=e[n];i.push(new this(t))}return i}return new this(e)};r.fromForm=function(){var e;return(e=new this).fromForm.apply(e,arguments)};r.recordsValues=function(){var e,t,n,r;t=[];r=this.records;for(e in r){n=r[e];t.push(n)}return t};r.cloneArray=function(e){var t,n,r,i;i=[];for(n=0,r=e.length;n<r;n++){t=e[n];i.push(t.clone())}return i};r.idCounter=0;r.uid=function(e){var t;e==null&&(e="");t=e+this.idCounter++;this.exists(t)&&(t=this.uid(e));return t};r.prototype.isNew=function(){return!this.exists()};r.prototype.isValid=function(){return!this.validate()};r.prototype.validate=function(){};r.prototype.load=function(e){var t,n;for(t in e){n=e[t];typeof this[t]=="function"?this[t](n):this[t]=n}return this};r.prototype.attributes=function(){var e,t,n,r,i;t={};i=this.constructor.attributes;for(n=0,r=i.length;n<r;n++){e=i[n];e in this&&(typeof this[e]=="function"?t[e]=this[e]():t[e]=this[e])}this.id&&(t.id=this.id);return t};r.prototype.eql=function(e){return!!(e&&e.constructor===this.constructor&&e.cid===this.cid||e.id&&e.id===this.id)};r.prototype.save=function(e){var t,n;e==null&&(e={});if(e.validate!==!1){t=this.validate();if(t){this.trigger("error",t);return!1}}this.trigger("beforeSave",e);n=this.isNew()?this.create(e):this.update(e);this.stripCloneAttrs();this.trigger("save",e);return n};r.prototype.stripCloneAttrs=function(){var e,t;if(this.hasOwnProperty("cid"))return;for(e in this){if(!d.call(this,e))continue;t=this[e];this.constructor.attributes.indexOf(e)>-1&&delete this[e]}return this};r.prototype.updateAttribute=function(e,t,n){var r;r={};r[e]=t;return this.updateAttributes(r,n)};r.prototype.updateAttributes=function(e,t){this.load(e);return this.save(t)};r.prototype.changeID=function(e){var t;t=this.constructor.records;t[e]=t[this.id];delete t[this.id];this.id=e;return this.save()};r.prototype.destroy=function(e){e==null&&(e={});this.trigger("beforeDestroy",e);delete this.constructor.records[this.id];delete this.constructor.crecords[this.cid];this.destroyed=!0;this.trigger("destroy",e);this.trigger("change","destroy",e);this.unbind();return this};r.prototype.dup=function(e){var t;t=new this.constructor(this.attributes());e===!1?t.cid=this.cid:delete t.id;return t};r.prototype.clone=function(){return u(this)};r.prototype.reload=function(){var e;if(this.isNew())return this;e=this.constructor.find(this.id);this.load(e.attributes());return e};r.prototype.toJSON=function(){return this.attributes()};r.prototype.toString=function(){return"<"+this.constructor.className+" ("+JSON.stringify(this)+")>"};r.prototype.fromForm=function(t){var n,r,i,s,o;r={};o=e(t).serializeArray();for(i=0,s=o.length;i<s;i++){n=o[i];r[n.name]=n.value}return this.load(r)};r.prototype.exists=function(){return this.id&&this.id in this.constructor.records};r.prototype.update=function(e){var t,n;this.trigger("beforeUpdate",e);n=this.constructor.records;n[this.id].load(this.attributes());t=n[this.id].clone();t.trigger("update",e);t.trigger("change","update",e);return t};r.prototype.create=function(e){var t,n;this.trigger("beforeCreate",e);this.id||(this.id=this.cid);n=this.dup(!1);this.constructor.records[this.id]=n;this.constructor.crecords[this.cid]=n;t=n.clone();t.trigger("create",e);t.trigger("change","create",e);return t};r.prototype.bind=function(e,t){var n,r,i=this;this.constructor.bind(e,n=function(e){if(e&&i.eql(e))return t.apply(i,arguments)});this.constructor.bind("unbind",r=function(t){if(t&&i.eql(t)){i.constructor.unbind(e,n);return i.constructor.unbind("unbind",r)}});return n};r.prototype.one=function(e,t){var n,r=this;return n=this.bind(e,function(){r.constructor.unbind(e,n);return t.apply(r,arguments)})};r.prototype.trigger=function(){var e,t;e=1<=arguments.length?h.call(arguments,0):[];e.splice(1,0,this);return(t=this.constructor).trigger.apply(t,e)};r.prototype.unbind=function(){return this.trigger("unbind")};return r}(s);t=function(t){function i(t){this.release=m(this.release,this);var n,r,s;this.options=t;s=this.options;for(n in s){r=s[n];this[n]=r}this.el||(this.el=document.createElement(this.tag));this.el=e(this.el);this.$el=this.el;this.className&&this.el.addClass(this.className);this.attributes&&this.el.attr(this.attributes);this.events||(this.events=this.constructor.events);this.elements||(this.elements=this.constructor.elements);this.events&&this.delegateEvents(this.events);this.elements&&this.refreshElements();i.__super__.constructor.apply(this,arguments)}v(i,t);i.include(n);i.include(r);i.prototype.eventSplitter=/^(\S+)\s*(.*)$/;i.prototype.tag="div";i.prototype.release=function(){this.trigger("release");this.el.remove();return this.unbind()};i.prototype.$=function(t){return e(t,this.el)};i.prototype.delegateEvents=function(e){var t,n,r,i,s,o,u=this;o=[];for(n in e){i=e[n];if(typeof i=="function")i=function(e){return function(){e.apply(u,arguments);return!0}}(i);else{if(!this[i])throw new Error(""+i+" doesn't exist");i=function(e){return function(){u[e].apply(u,arguments);return!0}}(i)}r=n.match(this.eventSplitter);t=r[1];s=r[2];s===""?o.push(this.el.bind(t,i)):o.push(this.el.delegate(s,t,i))}return o};i.prototype.refreshElements=function(){var e,t,n,r;n=this.elements;r=[];for(e in n){t=n[e];r.push(this[t]=this.$(e))}return r};i.prototype.delay=function(e,t){return setTimeout(this.proxy(e),t||0)};i.prototype.html=function(e){this.el.html(e.el||e);this.refreshElements();return this.el};i.prototype.append=function(){var e,t,n;t=1<=arguments.length?h.call(arguments,0):[];t=function(){var n,r,i;i=[];for(n=0,r=t.length;n<r;n++){e=t[n];i.push(e.el||e)}return i}();(n=this.el).append.apply(n,t);this.refreshElements();return this.el};i.prototype.appendTo=function(e){this.el.appendTo(e.el||e);this.refreshElements();return this.el};i.prototype.prepend=function(){var e,t,n;t=1<=arguments.length?h.call(arguments,0):[];t=function(){var n,r,i;i=[];for(n=0,r=t.length;n<r;n++){e=t[n];i.push(e.el||e)}return i}();(n=this.el).prepend.apply(n,t);this.refreshElements();return this.el};i.prototype.replace=function(t){var n,r;r=[this.el,e(t.el||t)],n=r[0],this.el=r[1];n.replaceWith(this.el);this.delegateEvents(this.events);this.refreshElements();return this.el};return i}(s);e=(typeof window!="undefined"&&window!==null?window.jQuery:void 0)||(typeof window!="undefined"&&window!==null?window.Zepto:void 0)||function(e){return e};u=Object.create||function(e){var t;t=function(){};t.prototype=e;return new t};a=function(e){return Object.prototype.toString.call(e)==="[object Array]"};f=function(e){var t;if(!e)return!0;for(t in e)return!1;return!0};l=function(e){return Array.prototype.slice.call(e,0)};o=this.Spine={};if(typeof module!="undefined"&&module!==null){console.log("module");module.exports=o}o.version="1.0.9";o.isArray=a;o.isBlank=f;o.$=e;o.Events=n;o.Log=r;o.Module=s;o.Controller=t;o.Model=i;s.extend.call(o,n);s.create=s.sub=t.create=t.sub=i.sub=function(e,t){var n;n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}v(t,e);return t}(this);e&&n.include(e);t&&n.extend(t);typeof n.unbind=="function"&&n.unbind();return n};i.setup=function(e,t){var n;t==null&&(t=[]);n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}v(t,e);return t}(this);n.configure.apply(n,[e].concat(h.call(t)));return n};o.Class=s}).call(this);
define("spine", function(){});

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    __slice = [].slice;

  define('data/models',['require','exports','module','spine'],function(require, exports, module) {
    var $, BaseModel, Spine, _ref;

    Spine = window.Spine || require('spine');
    $ = Spine.$;
    BaseModel = (function(_super) {
      __extends(BaseModel, _super);

      function BaseModel() {
        _ref = BaseModel.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      BaseModel.configure.apply(BaseModel, ['Base'].concat(__slice.call(BaseModel.attributes)));

      BaseModel.tryFind = function(id) {
        var e;

        try {
          return this.find(id);
        } catch (_error) {
          e = _error;
          return null;
        }
      };

      return BaseModel;

    })(Spine.Model);
    return exports = null;
  });

}).call(this);

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('data/controllers',['require','exports','module','spine','data/models','d3'],function(require, exports, module) {
    var $, MapController, Models, Spine, d3;

    Spine = window.Spine || require('spine');
    $ = Spine.$;
    Models = require('data/models');
    d3 = require('d3');
    MapController = (function(_super) {
      __extends(MapController, _super);

      MapController.prototype.map = null;

      function MapController() {
        this.d3LoadCounties = __bind(this.d3LoadCounties, this);
        this.d3LoadStates = __bind(this.d3LoadStates, this);        MapController.__super__.constructor.apply(this, arguments);
        this.d3LoadStates();
        this.d3LoadCounties();
      }

      MapController.prototype.d3LoadStates = function() {
        var svg,
          _this = this;

        svg = d3.select("#" + (this.el.attr('id'))).append('svg');
        this.states = svg.append('g').attr('id', 'states');
        this.states.attr('transform', 'scale(.75, .75)');
        return d3.json('/static/data/geo/gz_2010_us_040_00_20m.json', function(collection) {
          return _this.states.selectAll('path').data(collection.features).enter().append('path').classed('state', true).attr('d', d3.geo.path().projection(d3.geo.albersUsa())).attr('id', function(d) {
            return d.properties.STATE;
          }).style('fill-opacity', function(d) {
            var map_data, state, state_id;

            map_data = module.config().database_data;
            state_id = d.properties.STATE;
            state = map_data[0][state_id];
            return state.alpha * .01;
          }).on('mouseover', function() {
            return d3.select(this).classed('hover', true);
          }).on('mouseout', function() {
            return d3.select(this).classed('hover', false);
          }).append("svg:title").text(function(d) {
            return d.properties.NAME;
          });
        });
      };

      MapController.prototype.d3LoadCounties = function() {
        var svg,
          _this = this;

        svg = d3.select("#map2").append('svg');
        this.counties = svg.append('g').attr('id', 'counties');
        this.counties.attr('transform', 'scale(.75, .75)');
        return d3.json('/static/data/app/geo/gz_2010_us_050_00_20m.json', function(collection) {
          return _this.counties.selectAll('path').data(collection.features).enter().append('path').classed('state', true).attr('d', d3.geo.path().projection(d3.geo.albersUsa())).attr('id', function(d) {
            return "" + d.properties.STATE + d.properties.COUNTY;
          }).style('fill-opacity', function(d) {
            var county_fips, state_fips;

            county_fips = parseInt(d.properties.COUNTY, 10);
            state_fips = parseInt(d.properties.STATE, 10);
            county_fips /= 200;
            if (county_fips < 1) {
              return county_fips;
            } else {
              return 1;
            }
          }).on('mouseover', function() {
            return d3.select(this).classed('hover', true);
          }).on('mouseout', function() {
            return d3.select(this).classed('hover', false);
          });
        });
      };

      return MapController;

    })(Spine.Controller);
    return exports = {
      MapController: MapController
    };
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('data/app',['require','exports','module','spine','data/controllers','data/models'],function(require, exports, module) {
    var $, Controllers, MapViewController, Models, Spine;

    Spine = window.Spine || require('spine');
    $ = Spine.$;
    Controllers = require('data/controllers');
    Models = require('data/models');
    MapViewController = (function(_super) {
      __extends(MapViewController, _super);

      function MapViewController() {
        MapViewController.__super__.constructor.apply(this, arguments);
        this.mapController = new Controllers.MapController({
          el: $('div[data-controller=map]', this.el)
        });
      }

      return MapViewController;

    })(Spine.Controller);
    return exports = {
      MapViewController: MapViewController
    };
  });

}).call(this);

(function() {
  define('app/js/map',['jquery', 'd3', 'data/app'], function($, d3, controllers) {
    return new controllers.MapViewController({
      el: $('#database-app')
    });
  });

}).call(this);

require(["app/js/map"]);
}());